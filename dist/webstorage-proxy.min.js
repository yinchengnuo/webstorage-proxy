!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).WebStorageProxy=e()}(this,function(){"use strict";function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t,e){return t(e={exports:{}},e.exports),e.exports}var a="object"==typeof t&&t&&t.Object===Object&&t,r="object"==typeof self&&self&&self.Object===Object&&self,c=a||r||Function("return this")(),n=c.Symbol,i=Object.prototype,u=i.hasOwnProperty,s=i.toString,f=n?n.toStringTag:void 0;var p=function(t){var e=u.call(t,f),r=t[f];try{var n=!(t[f]=void 0)}catch(t){}var o=s.call(t);return n&&(e?t[f]=r:delete t[f]),o},h=Object.prototype.toString;var l=function(t){return h.call(t)},y=n?n.toStringTag:void 0;var _=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":y&&y in Object(t)?p(t):l(t)},v=Array.isArray;var d=function(t){return null!=t&&"object"==typeof t};var E=function(t){return"string"==typeof t||!v(t)&&d(t)&&"[object String]"==_(t)};var b=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)};var g=function(t){if(!b(t))return!1;var e=_(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e};function O(t){if(E(t))this._NAMESPACE=t;else if(g(t)){for(var e=[],r=0;r<window[this._TYPE].length;r++)window[this._TYPE].key(r).match(new RegExp(this._WEBSTORAGEPROXY_NAMESPACE+":"))&&e.push(window[this._TYPE].key(r).replace(new RegExp(this._WEBSTORAGEPROXY_NAMESPACE+":"),""));this._NAMESPACE=t(e)}else this.nameSpace=null}function S(){this.__data__=[],this.size=0}var T=function(t,e){return t===e||t!=t&&e!=e};var A=function(t,e){for(var r=t.length;r--;)if(T(t[r][0],e))return r;return-1},w=Array.prototype.splice;function P(t){var e=this.__data__,r=A(e,t);return!(r<0)&&(r==e.length-1?e.pop():w.call(e,r,1),--this.size,!0)}function j(t){var e=this.__data__,r=A(e,t);return r<0?void 0:e[r][1]}function R(t){return-1<A(this.__data__,t)}function m(t,e){var r=this.__data__,n=A(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this}function M(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}M.prototype.clear=S,M.prototype.delete=P,M.prototype.get=j,M.prototype.has=R,M.prototype.set=m;var Y=M;function G(){this.__data__=new Y,this.size=0}function I(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}function x(t){return this.__data__.get(t)}function B(t){return this.__data__.has(t)}var C,k=c["__core-js_shared__"],X=(C=/[^.]+$/.exec(k&&k.keys&&k.keys.IE_PROTO||""))?"Symbol(src)_1."+C:"";var z=function(t){return!!X&&X in t},W=Function.prototype.toString;var N=function(t){if(null!=t){try{return W.call(t)}catch(t){}try{return t+""}catch(t){}}return""},D=/^\[object .+?Constructor\]$/,F=Function.prototype,V=Object.prototype,U=F.toString,$=V.hasOwnProperty,L=RegExp("^"+U.call($).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var J=function(t){return!(!b(t)||z(t))&&(g(t)?L:D).test(N(t))};var q=function(t,e){return null==t?void 0:t[e]};var H=function(t,e){var r=q(t,e);return J(r)?r:void 0},K=H(c,"Map"),Q=H(Object,"create");function Z(){this.__data__=Q?Q(null):{},this.size=0}function tt(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var et=Object.prototype.hasOwnProperty;function rt(t){var e=this.__data__;if(Q){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return et.call(e,t)?e[t]:void 0}var nt=Object.prototype.hasOwnProperty;function ot(t){var e=this.__data__;return Q?void 0!==e[t]:nt.call(e,t)}function it(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=Q&&void 0===e?"__lodash_hash_undefined__":e,this}function at(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}at.prototype.clear=Z,at.prototype.delete=tt,at.prototype.get=rt,at.prototype.has=ot,at.prototype.set=it;var ct=at;var ut=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var st=function(t,e){var r=t.__data__;return ut(e)?r["string"==typeof e?"string":"hash"]:r.map};function ft(t){var e=st(this,t).delete(t);return this.size-=e?1:0,e}function pt(t){return st(this,t).get(t)}function ht(t){return st(this,t).has(t)}function lt(t,e){var r=st(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this}function yt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}yt.prototype.clear=function(){this.size=0,this.__data__={hash:new ct,map:new(K||Y),string:new ct}},yt.prototype.delete=ft,yt.prototype.get=pt,yt.prototype.has=ht,yt.prototype.set=lt;var _t=yt;function vt(t,e){var r=this.__data__;if(r instanceof Y){var n=r.__data__;if(!K||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new _t(n)}return r.set(t,e),this.size=r.size,this}function dt(t){var e=this.__data__=new Y(t);this.size=e.size}dt.prototype.clear=G,dt.prototype.delete=I,dt.prototype.get=x,dt.prototype.has=B,dt.prototype.set=vt;var Et=dt,bt=function(){try{var t=H(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();var gt=function(t,e,r){"__proto__"==e&&bt?bt(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r};var Ot=function(t,e,r){(void 0===r||T(t[e],r))&&(void 0!==r||e in t)||gt(t,e,r)};var St=function(u){return function(t,e,r){for(var n=-1,o=Object(t),i=r(t),a=i.length;a--;){var c=i[u?a:++n];if(!1===e(o[c],c,o))break}return t}}(),Tt=e(function(t,e){var r=e&&!e.nodeType&&e,n=r&&t&&!t.nodeType&&t,o=n&&n.exports===r?c.Buffer:void 0,i=o?o.allocUnsafe:void 0;t.exports=function(t,e){if(e)return t.slice();var r=t.length,n=i?i(r):new t.constructor(r);return t.copy(n),n}}),At=c.Uint8Array;var wt=function(t){var e=new t.constructor(t.byteLength);return new At(e).set(new At(t)),e};var Pt=function(t,e){var r=e?wt(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)};var jt=function(t,e){var r=-1,n=t.length;for(e=e||Array(n);++r<n;)e[r]=t[r];return e},Rt=Object.create;function mt(){}var Mt=function(t){if(!b(t))return{};if(Rt)return Rt(t);mt.prototype=t;var e=new mt;return mt.prototype=void 0,e};var Yt=function(e,r){return function(t){return e(r(t))}}(Object.getPrototypeOf,Object),Gt=Object.prototype;var It=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Gt)};var xt=function(t){return"function"!=typeof t.constructor||It(t)?{}:Mt(Yt(t))};var Bt=function(t){return d(t)&&"[object Arguments]"==_(t)},Ct=Object.prototype,kt=Ct.hasOwnProperty,Xt=Ct.propertyIsEnumerable,zt=Bt(function(){return arguments}())?Bt:function(t){return d(t)&&kt.call(t,"callee")&&!Xt.call(t,"callee")};var Wt=function(t){return"number"==typeof t&&-1<t&&t%1==0&&t<=9007199254740991};var Nt=function(t){return null!=t&&Wt(t.length)&&!g(t)};var Dt=function(t){return d(t)&&Nt(t)};function Ft(){return!1}var Vt=e(function(t,e){var r=e&&!e.nodeType&&e,n=r&&t&&!t.nodeType&&t,o=n&&n.exports===r?c.Buffer:void 0,i=(o?o.isBuffer:void 0)||Ft;t.exports=i}),Ut=Function.prototype,$t=Object.prototype,Lt=Ut.toString,Jt=$t.hasOwnProperty,qt=Lt.call(Object);var Ht=function(t){if(!d(t)||"[object Object]"!=_(t))return!1;var e=Yt(t);if(null===e)return!0;var r=Jt.call(e,"constructor")&&e.constructor;return"function"==typeof r&&r instanceof r&&Lt.call(r)==qt},Kt={};Kt["[object Float32Array]"]=Kt["[object Float64Array]"]=Kt["[object Int8Array]"]=Kt["[object Int16Array]"]=Kt["[object Int32Array]"]=Kt["[object Uint8Array]"]=Kt["[object Uint8ClampedArray]"]=Kt["[object Uint16Array]"]=Kt["[object Uint32Array]"]=!0,Kt["[object Arguments]"]=Kt["[object Array]"]=Kt["[object ArrayBuffer]"]=Kt["[object Boolean]"]=Kt["[object DataView]"]=Kt["[object Date]"]=Kt["[object Error]"]=Kt["[object Function]"]=Kt["[object Map]"]=Kt["[object Number]"]=Kt["[object Object]"]=Kt["[object RegExp]"]=Kt["[object Set]"]=Kt["[object String]"]=Kt["[object WeakMap]"]=!1;function Qt(t){return d(t)&&Wt(t.length)&&!!Kt[_(t)]}var Zt=function(e){return function(t){return e(t)}},te=e(function(t,e){var r=e&&!e.nodeType&&e,n=r&&t&&!t.nodeType&&t,o=n&&n.exports===r&&a.process,i=function(){try{var t=n&&n.require&&n.require("util").types;return t||o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=i}),ee=te&&te.isTypedArray,re=ee?Zt(ee):Qt;var ne=function(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]},oe=Object.prototype.hasOwnProperty;var ie=function(t,e,r){var n=t[e];oe.call(t,e)&&T(n,r)&&(void 0!==r||e in t)||gt(t,e,r)};var ae=function(t,e,r,n){var o=!r;r=r||{};for(var i=-1,a=e.length;++i<a;){var c=e[i],u=n?n(r[c],t[c],c,r,t):void 0;void 0===u&&(u=t[c]),o?gt(r,c,u):ie(r,c,u)}return r};var ce=function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n},ue=/^(?:0|[1-9]\d*)$/;var se=function(t,e){var r=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&ue.test(t))&&-1<t&&t%1==0&&t<e},fe=Object.prototype.hasOwnProperty;var pe=function(t,e){var r=v(t),n=!r&&zt(t),o=!r&&!n&&Vt(t),i=!r&&!n&&!o&&re(t),a=r||n||o||i,c=a?ce(t.length,String):[],u=c.length;for(var s in t)!e&&!fe.call(t,s)||a&&("length"==s||o&&("offset"==s||"parent"==s)||i&&("buffer"==s||"byteLength"==s||"byteOffset"==s)||se(s,u))||c.push(s);return c};var he=function(t){var e=[];if(null!=t)for(var r in Object(t))e.push(r);return e},le=Object.prototype.hasOwnProperty;var ye=function(t){if(!b(t))return he(t);var e=It(t),r=[];for(var n in t)("constructor"!=n||!e&&le.call(t,n))&&r.push(n);return r};var _e=function(t){return Nt(t)?pe(t,!0):ye(t)};var ve=function(t){return ae(t,_e(t))};var de=function(t,e,r,n,o,i,a){var c=ne(t,r),u=ne(e,r),s=a.get(u);if(s)Ot(t,r,s);else{var f=i?i(c,u,r+"",t,e,a):void 0,p=void 0===f;if(p){var h=v(u),l=!h&&Vt(u),y=!h&&!l&&re(u);f=u,h||l||y?f=v(c)?c:Dt(c)?jt(c):l?Tt(u,!(p=!1)):y?Pt(u,!(p=!1)):[]:Ht(u)||zt(u)?zt(f=c)?f=ve(c):b(c)&&!g(c)||(f=xt(u)):p=!1}p&&(a.set(u,f),o(f,u,n,i,a),a.delete(u)),Ot(t,r,f)}};var Ee=function n(o,i,a,c,u){o!==i&&St(i,function(t,e){if(u=u||new Et,b(t))de(o,i,e,a,n,c,u);else{var r=c?c(ne(o,e),t,e+"",o,i,u):void 0;void 0===r&&(r=t),Ot(o,e,r)}},_e)};function be(t){return t}var ge=function(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)},Oe=Math.max;var Se=function(i,a,c){return a=Oe(void 0===a?i.length-1:a,0),function(){for(var t=arguments,e=-1,r=Oe(t.length-a,0),n=Array(r);++e<r;)n[e]=t[a+e];e=-1;for(var o=Array(a+1);++e<a;)o[e]=t[e];return o[a]=c(n),ge(i,this,o)}};var Te=function(t){return function(){return t}},Ae=bt?function(t,e){return bt(t,"toString",{configurable:!0,enumerable:!1,value:Te(e),writable:!0})}:be,we=Date.now;var Pe=function(r){var n=0,o=0;return function(){var t=we(),e=16-(t-o);if(o=t,0<e){if(800<=++n)return arguments[0]}else n=0;return r.apply(void 0,arguments)}}(Ae);var je=function(t,e){return Pe(Se(t,e,be),t+"")};var Re=function(t,e,r){if(!b(r))return!1;var n=typeof e;return!!("number"==n?Nt(r)&&se(e,r.length):"string"==n&&e in r)&&T(r[e],t)};var me=function(c){return je(function(t,e){var r=-1,n=e.length,o=1<n?e[n-1]:void 0,i=2<n?e[2]:void 0;for(o=3<c.length&&"function"==typeof o?(n--,o):void 0,i&&Re(e[0],e[1],i)&&(o=n<3?void 0:o,n=1),t=Object(t);++r<n;){var a=e[r];a&&c(t,a,r,o)}return t})}(function(t,e,r){Ee(t,e,r)});var Me=function(){function n(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n);for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.init(e)}return function(t,e,r){e&&o(t.prototype,e),r&&o(t,r)}(n,[{key:"init",value:function(t){var e=this;return function(t){1==t.length?E(t[0])?(this._TYPE=t[0],this._MAXSPACE=null,this._NAMESPACE=null,this.beforeCreate=function(){},this.created=function(){},this.beforeGet=function(){},this.geted=function(){},this.beforeSet=function(){},this.proxySeted=function(){},this.storageSeted=function(){},this.beforeDestroy=function(){},this.destroyed=function(){},this.beforeBeyond=function(){},this.encryption=function(){},this.decryption=function(){}):b(t[0])&&(this._TYPE=t[0].type,this._MAXSPACE=1024*t[0].maxSpace*1024,O.call(this,t[0].nameSpace),g(t[0].beforeCreate)&&(this.beforeCreate=t[0].beforeCreate),g(t[0].created)&&(this.created=t[0].created),g(t[0].beforeGet)&&(this.beforeGet=t[0].beforeGet),g(t[0].geted)&&(this.geted=t[0].geted),g(t[0].beforeSet)&&(this.beforeSet=t[0].beforeSet),g(t[0].proxySeted)&&(this.proxySeted=t[0].proxySeted),g(t[0].storageSeted)&&(this.storageSeted=t[0].storageSeted),g(t[0].beforeDestroy)&&(this.beforeDestroy=t[0].beforeDestroy),g(t[0].destroyed)&&(this.destroyed=t[0].destroyed),g(t[0].beforeBeyond)&&(this.beforeBeyond=t[0].beforeBeyond),g(t[0].encryption)&&(this.encryption=t[0].encryption),g(t[0].decryption)&&(this.decryption=t[0].decryption)):(this._TYPE=t[0],this._MAXSPACE=1024*t[1]*1024,O.call(this,t[2]),this.beforeCreate=function(){},this.created=function(){},this.beforeGet=function(){},this.geted=function(){},this.beforeSet=function(){},this.proxySeted=function(){},this.storageSeted=function(){},this.beforeDestroy=function(){},this.destroyed=function(){},this.beforeBeyond=function(){},this.encryption=function(){},this.decryption=function(){})}.call(this,t),null===sessionStorage.getItem(this._WEBSTORAGEPROXY_STROAGE_OVERRODE)&&function(r){function n(t){return t.split(":")[0]===r._WEBSTORAGEPROXY||t.split(":")[0]===r._WEBSTORAGEPROXY_NAMESPACE||t.split(":")[0]===r._WEBSTORAGEPROXY_STROAGE_OVERRODE}Storage.prototype[r._CLEAR]=Storage.prototype.clear,Storage.prototype[r._GETITEM]=Storage.prototype.getItem,Storage.prototype[r._SETITEM]=Storage.prototype.setItem,Storage.prototype[r._REMOVEITEM]=Storage.prototype.removeItem,Storage.prototype.clear=function(){function t(t){for(;t<e.length;)n(e.key(t))?t++:e[r._REMOVEITEM](e.key(t))}var e=this;t(0),t(0)},Storage.prototype.getItem=function(t){return!n(t)&&this[r._GETITEM](t)},Storage.prototype.setItem=function(t,e){return n(t)||this[r._SETITEM](t,e),!1},Storage.prototype.removeItem=function(t){return n(t)||this[r._REMOVEITEM](t),!1}}(n.prototype),this.beforeCreate.call(window),Promise.resolve().then(function(){e.created()}),this.state=Object.create(this),this.state.map(),this.proxy(),this.state}},{key:"map",value:function(){(function(){if(this._NAMESPACE){var t=window[this._TYPE][this._GETITEM]("".concat(this._WEBSTORAGEPROXY_NAMESPACE,":").concat(this._NAMESPACE));t?me(this,JSON.parse(t)):window[this._TYPE][this._SETITEM]("".concat(this._WEBSTORAGEPROXY_NAMESPACE,":").concat(this._NAMESPACE),"")}else for(var e=0;e<window[this._TYPE].length;e++)if(!window[this._TYPE].key(e).match("_WEBSTORAGEPROXY_NAMESPACE"))if(window[this._TYPE].key(e).split("_WEBSTORAGEPROXY:")[1])try{this[window[this._TYPE].key(e).split("_WEBSTORAGEPROXY:")[1]]=JSON.parse(window[this._TYPE][this._GETITEM](window[this._TYPE].key(e)))}catch(t){this[window[this._TYPE].key(e).split("_WEBSTORAGEPROXY:")[1]]=window[this._TYPE][this._GETITEM](window[this._TYPE].key(e))}else try{this[window[this._TYPE].key(e)]=JSON.parse(window[this._TYPE][this._GETITEM](window[this._TYPE].key(e)))}catch(t){this[window[this._TYPE].key(e)]=window[this._TYPE][this._GETITEM](window[this._TYPE].key(e))}}).call(this)}},{key:"proxy",value:function(){(function(){var r=this;this.state=function n(e){var o=r,t=new Proxy(e,{get:function(t,e){return o.beforeGet.call(t,e),Promise.resolve().then(function(){o.geted.call(t,e)}),t[e]},set:function(t,e,r){o.beforeSet.call(t,e,r),"function"==typeof r?console.log("isFunction"):b(r)||v(r)?t[e]=n(r):t[e]=r,o.proxySeted.call(t,e,r),console.log("更新storage")}});return Object.keys(e).forEach(function(t){(b(t)||v(t))&&(e[t]=n(e[t]))}),t}(this.state)}).call(this)}}]),n}();return Me.prototype._CLEAR=Symbol("clear"),Me.prototype._GETITEM=Symbol("getItem"),Me.prototype._SETITEM=Symbol("setItem"),Me.prototype._REMOVEITEM=Symbol("removeItem"),Me.prototype._WEBSTORAGEPROXY="_WEBSTORAGEPROXY",Me.prototype._WEBSTORAGEPROXY_NAMESPACE="_WEBSTORAGEPROXY_NAMESPACE",Me.prototype._WEBSTORAGEPROXY_STROAGE_OVERRODE="_WEBSTORAGEPROXY_STROAGE_OVERRODE",Me});
